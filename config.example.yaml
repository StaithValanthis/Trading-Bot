# Bybit Trading Bot Configuration Example
# Copy this to config.yaml and fill in your values
# Secrets (API keys, webhook URL) should be in .env file

# Exchange settings
exchange:
  name: bybit
  # Account type: testnet or mainnet (mainnet for production)
  testnet: true
  # Mode: paper (simulate only, no real orders), testnet, or live
  # IMPORTANT: Set to 'live' only when you want real trading!
  mode: testnet
  # API keys should be in .env file:
  # BYBIT_API_KEY=your_key_here
  # BYBIT_API_SECRET=your_secret_here
  # API keys are loaded from environment variables
  symbols:
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - ADAUSDT
  # Trading timeframe (default 4h: cleaner signals & aligned with 8h funding cycle)
  timeframe: 4h
  # How often the main loop checks for new signals/rebalancing (minutes)
  # Default: 60 minutes. For 15m timeframes, consider 15-30 minutes for faster reaction
  loop_check_interval_minutes: 60
  # Estimated taker fee (used in backtests/optimizer)
  taker_fee: 0.00055
  # Optional constant funding estimate (per 8h). Set to 0 to disable.
  funding_rate_per_8h: 0.0
  # Optional per-symbol funding estimates (per 8h). Overrides global rate when provided.
  symbol_funding_rates:
    # BTCUSDT: 0.00015
    # ETHUSDT: -0.00005

# Strategy parameters
strategy:
  # Sleeve A: Time-series trend-following
  trend:
    # Short moving average period (bars; 5 bars @4h ≈ 20h)
    ma_short: 15
    # Long moving average period (bars; 25 bars @4h ≈ 100h)
    ma_long: 50
    # Momentum lookback (bars; 6 bars @4h ≈ 24h)
    momentum_lookback: 12
    # ATR multiplier for stop-loss distance
    atr_stop_multiplier: 2.5
    # ATR lookback for volatility calculation (bars; 4 bars @4h ≈ 16h)
    atr_period: 10
    # Minimum ATR filter: skip trades if ATR < min_atr_threshold * price
    min_atr_threshold: 0.001  # 0.1% of price
    # Position management
    # Optional: Maximum holding period in hours (null = no limit)
    # Useful for closing stale positions that haven't moved
    max_holding_hours: null  # e.g., 168 = 7 days
    # Optional: Take-profit as risk-reward multiple (null = no TP, let winners run)
    # e.g., 2.0 = TP at 2x the SL distance from entry
    take_profit_rr: null  # Recommended: null for trend-following, 2.0-3.0 for mean-reversion
    # Trailing stop settings
    use_trailing_stop: false  # Enable trailing stops
    trailing_stop_atr_multiplier: 1.5  # Trailing stop distance (ATR multiplier)
    trailing_stop_activation_rr: 1.0  # Activate trailing after this RR profit (e.g., 1.0 = break-even)
    
  # Sleeve B: Cross-sectional momentum overlay
  cross_sectional:
    # Ranking window (bars; 18 bars @4h ≈ 3 days)
    # Exit band (hysteresis): only close positions if rank falls below top_k + exit_band
    # This reduces churn from minor ranking changes (default: 2)
    exit_band: 1
    ranking_window: 18
    # Number of top symbols to trade
    top_k: 10
    # Rebalance frequency in hours (8h aligns with funding settlements)
    rebalance_frequency_hours: 6
    # Only trade symbols that also have positive time-series trend
    require_trend_alignment: true
    
  # Sleeve C: Funding-rate bias overlay
  funding_bias:
    # Minimum absolute funding rate to apply bias (e.g. 0.0005 = 0.05% per 8h)
    min_funding_threshold: 0.0005
    # If funding is positive and we'd go long, reduce size by this factor
    positive_funding_size_reduction: 0.5
    # If funding is negative and we'd go long, allow slightly larger size (capped)
    negative_funding_size_boost: 1.2
    # Max boost factor (safety cap)
    max_boost_factor: 1.5

# Risk management
risk:
  # Per-trade risk as fraction of equity (e.g. 0.005 = 0.5%, 0.02 = 2%)
  # NOTE: For small accounts (< $500), consider 0.015-0.025 (1.5-2.5%) to meet $5 minimum order size
  # For larger accounts (> $1000), 0.005-0.01 (0.5-1%) is more conservative
  per_trade_risk_fraction: 0.02
  # Maximum gross leverage (sum of |notional| / equity)
  max_leverage: 3.0
  # Maximum % of equity in any single symbol (notional)
  max_symbol_fraction: 0.30
  # Maximum number of concurrent open positions
  max_positions: 10
  # Soft daily loss cap: reduce risk after this loss (% of equity)
  daily_soft_loss_pct: -2.0
  # Hard daily loss cap: stop trading after this loss (% of equity)
  daily_hard_loss_pct: -4.0
  # Fractional Kelly aggressiveness (0.0-1.0, 0.5 = half-Kelly)
  kelly_fraction: 0.5
  # Advanced: approximate minimum liquidation distance as 100 / effective_leverage >= this value.
  # This is a conservative check based on gross leverage only (not exact exchange liquidation math).
  min_liquidation_distance_pct: 5.0
  # Stop-loss and take-profit order management
  # Place real stop-loss orders on exchange (mandatory for production)
  use_server_side_stops: true
  # Stop order type: "stop_market" (more robust, higher slippage) or "stop_limit" (risk of not filling)
  stop_order_type: stop_market
  # Backtest slippage modeling (basis points)
  stop_slippage_bps: 10.0  # 10 bps = 0.1% slippage when stop is hit
  tp_slippage_bps: 5.0  # 5 bps = 0.05% slippage for take-profit (usually tighter)

# Data & backtest settings
data:
  # Number of bars to fetch for signal calculation
  lookback_bars: 500
  # Database file path
  db_path: data/trading_bot.db

# Universe selection
universe:
  # Liquidity filters
  # Minimum 24h notional volume for entry ($2M USDT default for retail-sized account)
  min_24h_volume_entry: 2_000_000
  # Minimum 24h volume to stay in universe ($1M USDT default, hysteresis)
  min_24h_volume_exit: 1_000_000
  # Number of consecutive days volume must be above/below threshold
  volume_check_days: 3
  # Optional: minimum open interest (set e.g. 2_000_000 for stricter OI filter; null to disable)
  min_open_interest: null
  # Optional: maximum bid-ask spread in basis points (25 = 0.25%, set null to disable)
  max_spread_bps: 25.0
  
  # Historical data requirements
  # Minimum days of continuous OHLCV history required
  min_history_days: 90
  # Extra days of history to download beyond the minimum (buffer for gaps/off-by-one)
  history_buffer_days: 5
  # Warm-up period: new listings must pass filters for this many days before entry
  warmup_days: 7
  # Maximum percentage of missing candles allowed (timeframe-aware)
  max_data_gap_pct: 10.0
  # Maximum days since last data update (data must be fairly recent)
  max_days_since_last_update: 3
  
  # Volatility & price filters
  # Minimum price in USDT (reject dust coins)
  min_price_usdt: 0.10
  # Maximum annualized realized volatility (%)
  max_realized_vol_pct: 300.0
  # Maximum percentage of days with limit-up/limit-down moves
  # Advanced: currently not enforced in code; reserved for future volatility sanity checks
  limit_move_frequency_pct: 5.0
  
  # Universe stability (hysteresis)
  # Minimum days symbol must stay in universe before it can be removed
  min_time_in_universe_days: 7
  # Maximum percentage of universe that can change per rebalance (20% default)
  max_turnover_per_rebalance_pct: 20.0
  
  # Rebalancing frequency
  # How often to recompute universe (hours)
  rebalance_frequency_hours: 24
  
  # Override lists
  # Preferred symbols: These symbols will be prioritized and always evaluated for universe membership,
  # but they MUST still pass all filters (liquidity, data, volatility, delisted status, etc.)
  # If a preferred symbol fails filters, it will be logged as a warning and excluded until it passes.
  # Leave empty [] to use pure filter-based selection without preferences.
  include_list: []
  # Symbols that are never included (always excluded, even if they pass all filters)
  exclude_list: []
  
  # Optional: bucket limits (not implemented yet)
  # max_symbols_per_bucket: {}

# Optimizer settings
optimizer:
  # Number of months of historical data to use
  # Recommended: 12-18 months for robust optimization across market regimes
  lookback_months: 12
  # Walk-forward window size in days
  # Recommended: 60-90 days for crypto to capture full market cycles
  walk_forward_window_days: 60
  # Minimum number of trades required to consider a parameter set
  # Recommended: 30-50 trades for statistical significance
  min_trades: 30
  # Minimum Sharpe ratio to consider updating
  min_sharpe_ratio: 1.0
  # Maximum drawdown allowed (%)
  max_drawdown_pct: -15.0
  # Parameter search method: grid, random, or bayesian
  search_method: random
  # Number of parameter sets to test
  # Recommended: 100-200 for thorough exploration (vs 2,880 total combinations)
  n_trials: 100
  # Optional seed to make optimizer runs reproducible
  random_seed: 1337
  # Use historical universe membership when optimizing (prevents look-ahead)
  use_universe_history: true
  # Parameter ranges (if using random/bayesian search)
  # FOCUSED ranges for efficient optimization (~50k combinations, 100-200 trials = 0.2-0.4% coverage)
  # Adjust these based on your timeframe and strategy preferences
  param_ranges:
    # Moving averages: focused range around proven values
    # Short MA: 5-20 bars (covers 20h to 80h on 4h timeframe, or 1.25h to 5h on 15m)
    ma_short: [5, 8, 10, 12, 15]
    # Long MA: 50-150 bars (covers 200h to 600h on 4h, or 12.5h to 37.5h on 15m)
    ma_long: [50, 80, 100, 150]
    
    # Momentum lookback: 6-36 bars (covers 24h to 6 days on 4h, or 1.5h to 9h on 15m)
    momentum_lookback: [6, 12, 18, 24]
    
    # ATR stop multiplier: standard range (2.0-3.0)
    atr_stop_multiplier: [2.0, 2.5, 3.0]
    
    # ATR period: 4-18 bars (short to medium volatility windows)
    atr_period: [4, 7, 10, 14]
    
    # Cross-sectional: portfolio size (concentrated to moderate diversification)
    top_k: [3, 4, 5, 6]
    
    # Ranking window: 12-36 bars (medium-term momentum ranking)
    ranking_window: [12, 18, 24]
    
    # Exit band (hysteresis): prevents churn (keep simple)
    exit_band: [1, 2]
    
    # Rebalance frequency: 4h to 24h (aligns with funding cycles) - reduced options
    rebalance_frequency_hours: [4, 6, 8]
  # Sampling method for random search: uniform or latin (stratified)
  sample_method: latin
  # Warn if coverage (n_trials / total combos) drops below this fraction
  coverage_warning_threshold: 0.0001
  # Minimum % of OOS walk-forward windows that must be profitable
  min_positive_windows: 0.5
  # Maximum allowed OOS Sharpe standard deviation (set null to disable)
  max_oos_sharpe_std: null
  # Maximum tolerated worst OOS drawdown (set e.g. -30.0 to reject configs worse than -30%). null = disabled
  max_worst_oos_dd: null
  # Number of rolling walk-forward folds to average (1 = single split, >1 = multiple folds)
  walk_forward_folds: 1
  # Embargo period in days: gap between IS and OOS windows to reduce leakage (0 = disabled)
  embargo_days: 0

# Universe optimizer settings (for universe parameter optimization)
universe_optimizer:
  # Number of parameter combinations to test (default: 200)
  n_combinations: 200
  # Search method: random or grid
  search_method: random
  # Default backtest period (if not specified via CLI)
  default_start_date: "2023-01-01"
  default_end_date: "2024-01-01"
  # Constraint thresholds
  min_avg_universe_size: 10
  max_avg_universe_size: 100
  max_universe_turnover_pct: 50.0
  max_drawdown_pct: -30.0
  min_total_trades: 50
  min_win_rate: 0.35

# Reporting
reporting:
  # Discord webhook URL (should be in .env: DISCORD_WEBHOOK_URL=...)
  # discord_webhook_url: loaded from .env
  # Daily report time (UTC, HH:MM format)
  report_time_utc: "09:00"
  # Include detailed strategy breakdown in report
  include_strategy_breakdown: true

# Logging
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR
  level: INFO
  # Log directory
  log_dir: logs
  # Max log file size in MB before rotation
  max_log_size_mb: 10
  # Number of backup log files to keep
  backup_count: 5

